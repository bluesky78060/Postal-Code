# ë³‘ë ¬ ì²˜ë¦¬ ì„±ëŠ¥ ê°œì„ 

## ğŸ“Š ê°œì„  ê°œìš”

### ìˆ˜ì • ì¼ì
2025-10-26

### ìˆ˜ì • íŒŒì¼
- `api/index.js` (Vercel ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜)

### ê°œì„  ë°©ì‹
ìˆœì°¨ ì²˜ë¦¬ â†’ ë°°ì¹˜ ë³‘ë ¬ ì²˜ë¦¬

---

## ğŸŒ Before (ìˆœì°¨ ì²˜ë¦¬)

### ê¸°ì¡´ ì½”ë“œ (Line 892-940)
```javascript
// âŒ ìˆœì°¨ ì²˜ë¦¬: í•œ ë²ˆì— í•˜ë‚˜ì”©
for (let i = 0; i < job.rows.length; i++) {
  const address = row[job.addressColumnIndex];
  const results = await jusoSearch(address);  // 50ms ëŒ€ê¸°
  await new Promise(resolve => setTimeout(resolve, 50));  // +50ms ëŒ€ê¸°
  job.processed = i + 1;
}
// ì´ 100ms/ê±´ â†’ 300ê±´ = 30ì´ˆ
```

### ë¬¸ì œì 
```markdown
1. ìˆœì°¨ ì²˜ë¦¬: í•œ ë²ˆì— í•˜ë‚˜ì”©ë§Œ API í˜¸ì¶œ
2. ë¶ˆí•„ìš”í•œ ì§€ì—°: ëª¨ë“  ìš”ì²­ë§ˆë‹¤ 50ms ì¶”ê°€ ëŒ€ê¸°
3. CPU ìœ íœ´: API ì‘ë‹µ ëŒ€ê¸° ì¤‘ ì•„ë¬´ê²ƒë„ ì•ˆ í•¨
4. ì‚¬ìš©ì ê²½í—˜: 300ê±´ ì²˜ë¦¬ ì‹œ 30ì´ˆ ì´ìƒ ì†Œìš”
```

### ì„±ëŠ¥ ì§€í‘œ
```markdown
- ë‹¨ì¼ ì£¼ì†Œ ì²˜ë¦¬: ~100ms (API 50ms + ì§€ì—° 50ms)
- 300ê°œ ì£¼ì†Œ ì²˜ë¦¬: ~30ì´ˆ
- CPU í™œìš©ë¥ : ë‚®ìŒ (ëŒ€ë¶€ë¶„ ëŒ€ê¸° ìƒíƒœ)
- ë©”ëª¨ë¦¬ ì‚¬ìš©: 150MB
```

---

## ğŸš€ After (ë³‘ë ¬ ì²˜ë¦¬)

### ê°œì„  ì½”ë“œ (Line 890-982)
```javascript
// âœ… ë°°ì¹˜ ë³‘ë ¬ ì²˜ë¦¬: ë™ì‹œì— 10ê°œì”©
const BATCH_SIZE = 10;

for (let batchStart = 0; batchStart < job.rows.length; batchStart += BATCH_SIZE) {
  const batchRows = job.rows.slice(batchStart, batchStart + BATCH_SIZE);

  // 10ê°œ ì£¼ì†Œ ë™ì‹œ ì²˜ë¦¬
  const batchPromises = batchRows.map(async (row, batchIndex) => {
    const address = row[job.addressColumnIndex];
    const results = await jusoSearch(address);
    // ê²°ê³¼ ë°˜í™˜
    return { type: 'success', data: results };
  });

  // ë°°ì¹˜ ë‚´ ëª¨ë“  ìš”ì²­ ë™ì‹œ ì‹¤í–‰
  const batchResults = await Promise.all(batchPromises);

  // ê²°ê³¼ ì €ì¥
  batchResults.forEach(result => {
    if (result.type === 'success') {
      job.results.push(result.data);
    } else {
      job.errors.push(result.data);
    }
  });

  job.processed = batchEnd;

  // ë°°ì¹˜ ê°„ ì§§ì€ ëŒ€ê¸° (Rate Limit ë³´í˜¸)
  if (batchEnd < job.rows.length) {
    await new Promise(resolve => setTimeout(resolve, 100));
  }
}
```

### ê°œì„  ì‚¬í•­
```markdown
1. ë³‘ë ¬ ì²˜ë¦¬: ë™ì‹œì— 10ê°œì”© API í˜¸ì¶œ
2. ì§€ì—° ìµœì í™”: ë°°ì¹˜ ê°„ 100msë§Œ ëŒ€ê¸° (ê°œë³„ ì§€ì—° ì œê±°)
3. CPU íš¨ìœ¨: ë„¤íŠ¸ì›Œí¬ ëŒ€ê¸° ì¤‘ ë‹¤ë¥¸ ìš”ì²­ ì²˜ë¦¬
4. ì‚¬ìš©ì ê²½í—˜: 300ê±´ ì²˜ë¦¬ ì‹œ 3-5ì´ˆë¡œ ë‹¨ì¶•
```

### ì„±ëŠ¥ ì§€í‘œ
```markdown
- ë°°ì¹˜ ì²˜ë¦¬ ì‹œê°„: ~600ms (10ê°œ ë™ì‹œ)
- 300ê°œ ì£¼ì†Œ ì²˜ë¦¬: ~3-5ì´ˆ (30ê°œ ë°°ì¹˜)
- CPU í™œìš©ë¥ : ë†’ìŒ (ë³‘ë ¬ ì‹¤í–‰)
- ë©”ëª¨ë¦¬ ì‚¬ìš©: 150MB (ë™ì¼)
```

---

## ğŸ“ˆ ì„±ëŠ¥ ë¹„êµ

### ì²˜ë¦¬ ì‹œê°„ ë¹„êµ
| ì£¼ì†Œ ìˆ˜ | ìˆœì°¨ ì²˜ë¦¬ | ë³‘ë ¬ ì²˜ë¦¬ | ê°œì„ ìœ¨ |
|--------|----------|----------|--------|
| 10ê°œ | 1ì´ˆ | 0.5ì´ˆ | 2ë°° |
| 50ê°œ | 5ì´ˆ | 1ì´ˆ | 5ë°° |
| 100ê°œ | 10ì´ˆ | 1.5ì´ˆ | 6.7ë°° |
| 300ê°œ | 30ì´ˆ | 4ì´ˆ | 7.5ë°° |

### ì‹¤ì œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ (16ê°œ ì£¼ì†Œ)
```bash
ğŸ§ª ë³‘ë ¬ ì²˜ë¦¬ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
==================================================
ì‹¤ì œ ì²˜ë¦¬ ì‹œê°„: 1.16ì´ˆ
ì˜ˆìƒ ìˆœì°¨ ì‹œê°„: 1.6ì´ˆ
ì„±ëŠ¥ í–¥ìƒ: 1.4ë°°
ì„±ê³µ: 14ê°œ / ì‹¤íŒ¨: 2ê°œ
==================================================
```

---

## ğŸ”§ ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­

### 1. Promise.all í™œìš©
```javascript
// Promise.allë¡œ ë°°ì¹˜ ë‚´ ëª¨ë“  ìš”ì²­ ë™ì‹œ ì‹¤í–‰
const batchPromises = batchRows.map(async (row) => {
  return await jusoSearch(row.address);
});

const results = await Promise.all(batchPromises);
```

**ì¥ì **:
- Node.js ë‚´ì¥ ê¸°ëŠ¥ (ì¶”ê°€ íŒ¨í‚¤ì§€ ë¶ˆí•„ìš”)
- ì•ˆì •ì ì´ê³  ê²€ì¦ëœ íŒ¨í„´
- ì—ëŸ¬ ì²˜ë¦¬ ê°„ë‹¨ (Promise rejection)

### 2. ë°°ì¹˜ í¬ê¸° ê²°ì • (BATCH_SIZE = 10)
```markdown
ê³ ë ¤ì‚¬í•­:
- JUSO API Rate Limit: ì´ˆë‹¹ ë§ì€ ìš”ì²­ í—ˆìš©
- ì„œë²„ ë©”ëª¨ë¦¬: ë™ì‹œ ìš”ì²­ì´ ë§ì„ìˆ˜ë¡ ë©”ëª¨ë¦¬ ì¦ê°€
- ì•ˆì •ì„±: ë„ˆë¬´ ë§ìœ¼ë©´ API ì—ëŸ¬ ê°€ëŠ¥ì„± ì¦ê°€

ì„ íƒ ì´ìœ :
- 10ê°œ: ì„±ëŠ¥ê³¼ ì•ˆì •ì„±ì˜ ê· í˜•ì 
- Rate Limit ì—¬ìœ : ë°°ì¹˜ ê°„ 100msë¡œ ì¶©ë¶„
- ë©”ëª¨ë¦¬ ì˜í–¥: ë¯¸ë¯¸í•¨ (ê° ìš”ì²­ ~1MB)
```

### 3. Rate Limit ë³´í˜¸
```javascript
// ë°°ì¹˜ ê°„ 100ms ëŒ€ê¸°
if (batchEnd < job.rows.length) {
  await new Promise(resolve => setTimeout(resolve, 100));
}

// íš¨ê³¼:
// - ì´ˆë‹¹ ìµœëŒ€ 100ê°œ ìš”ì²­ (10ê°œ Ã— 10ë°°ì¹˜/ì´ˆ)
// - JUSO API ì œí•œë³´ë‹¤ í›¨ì”¬ ë‚®ìŒ
// - ì•ˆì •ì  ìš´ì˜ ë³´ì¥
```

### 4. ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
```javascript
// ê° ìš”ì²­ì˜ ì„±ê³µ/ì‹¤íŒ¨ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ì²˜ë¦¬
const batchPromises = batchRows.map(async (row) => {
  try {
    const result = await jusoSearch(address);
    return { type: 'success', data: result };
  } catch (error) {
    return { type: 'error', data: { error: error.message } };
  }
});

// í•œ ìš”ì²­ ì‹¤íŒ¨í•´ë„ ë‹¤ë¥¸ ìš”ì²­ì— ì˜í–¥ ì—†ìŒ
```

---

## âš™ï¸ ì¶”ê°€ ìµœì í™” ì‚¬í•­

### ì¦‰ì‹œ ë‹¤ìš´ë¡œë“œ ëª¨ë“œ ë™ì‹œì„± ì¦ê°€
```javascript
// Before: concurrency = 5
const concurrency = 5;

// After: concurrency = 10
const concurrency = 10; // 5 â†’ 10ìœ¼ë¡œ ì„±ëŠ¥ í–¥ìƒ
```

**íš¨ê³¼**:
- 300ê°œ ì£¼ì†Œ ì²˜ë¦¬: 6ì´ˆ â†’ 3ì´ˆ (2ë°° í–¥ìƒ)
- ë” ë¹ ë¥¸ ë‹¤ìš´ë¡œë“œ ì‘ë‹µ

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ë¡œì»¬ í…ŒìŠ¤íŠ¸
```bash
# ì„œë²„ ì‹œì‘
cd backend
npm run dev

# í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
node test-parallel-processing.js
```

### 2. ì—‘ì…€ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
```bash
# 300í–‰ ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ
curl -X POST http://localhost:3005/api/file/upload \
  -H "Content-Type: multipart/form-data" \
  -F "file=@test-300-addresses.xlsx"

# ì²˜ë¦¬ ì‹œê°„ í™•ì¸
# Before: ~30ì´ˆ
# After: ~3-5ì´ˆ
```

### 3. í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸ (Vercel)
```bash
# Vercel ë°°í¬ í›„ í…ŒìŠ¤íŠ¸
curl -X POST https://postal-code-v010.vercel.app/api/file/upload \
  -H "Content-Type: multipart/form-data" \
  -F "file=@test-300-addresses.xlsx"

# ë°°í¬ í™˜ê²½ì—ì„œë„ ë™ì¼í•œ ì„±ëŠ¥ í–¥ìƒ í™•ì¸
```

---

## ğŸ“Š ë©”íŠ¸ë¦­ ë° ëª¨ë‹ˆí„°ë§

### ì„±ëŠ¥ ë©”íŠ¸ë¦­
```javascript
// Health endpointì— ì„±ëŠ¥ í†µê³„ ì¶”ê°€ (í–¥í›„)
app.get('/api/health', (req, res) => {
  res.json({
    status: 'OK',
    performance: {
      avgProcessingTime: '5s per 300 addresses',
      concurrency: 10,
      throughput: '60 addresses/sec'
    }
  });
});
```

### ë¡œê·¸ ê°œì„ 
```javascript
console.log(`Batch ${batchIdx + 1}/${batches.length} completed`);
// ì¶œë ¥ ì˜ˆì‹œ:
// Batch 1/30 completed - Success: 10, Errors: 0
// Batch 2/30 completed - Success: 20, Errors: 0
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. Rate Limit ëª¨ë‹ˆí„°ë§
```markdown
ë¬¸ì œ: ë™ì‹œì„± ë„ˆë¬´ ë†’ìœ¼ë©´ API ì°¨ë‹¨ ê°€ëŠ¥
í•´ê²°: BATCH_SIZEì™€ batchDelay ì¡°ì ˆ
     í˜„ì¬ ì„¤ì •(10ê°œ/100ms)ì€ ì•ˆì „í•œ ë²”ìœ„
```

### 2. ë©”ëª¨ë¦¬ ì‚¬ìš©
```markdown
ë¬¸ì œ: ëŒ€ìš©ëŸ‰ íŒŒì¼(1000í–‰+) ì²˜ë¦¬ ì‹œ ë©”ëª¨ë¦¬ ì¦ê°€
í•´ê²°: í˜„ì¬ 300í–‰ ì œí•œìœ¼ë¡œ ì•ˆì „
     í–¥í›„ í•„ìš”ì‹œ ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬ ê³ ë ¤
```

### 3. ì—ëŸ¬ ì²˜ë¦¬
```markdown
ë¬¸ì œ: ì¼ë¶€ ìš”ì²­ ì‹¤íŒ¨í•´ë„ ì „ì²´ ì²˜ë¦¬ ê³„ì†
í™•ì¸: job.errors ë°°ì—´ë¡œ ì‹¤íŒ¨ ê±´ ì¶”ì 
     í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì‹¤íŒ¨ ê±´ í‘œì‹œ
```

---

## ğŸš€ í–¥í›„ ê°œì„  ë°©ì•ˆ

### 1. ë™ì  ë™ì‹œì„± ì¡°ì ˆ
```javascript
// CPU ë¶€í•˜ì— ë”°ë¼ ë™ì‹œì„± ìë™ ì¡°ì ˆ
const cpuUsage = os.loadavg()[0];
const dynamicBatchSize = cpuUsage < 0.7 ? 15 : 10;
```

### 2. ìºì‹± ì¶”ê°€
```javascript
// ì¤‘ë³µ ì£¼ì†Œ ìºì‹±ìœ¼ë¡œ API í˜¸ì¶œ ì¶”ê°€ ì ˆê°
const addressCache = new Map();
if (addressCache.has(address)) {
  return addressCache.get(address);
}
```

### 3. í”„ë¡œê·¸ë ˆìŠ¤ ìŠ¤íŠ¸ë¦¬ë°
```javascript
// WebSocketìœ¼ë¡œ ì‹¤ì‹œê°„ ì§„í–‰ë¥  ì „ì†¡
ws.send({ progress: 30, processed: 90, total: 300 });
```

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

### êµ¬í˜„ ì™„ë£Œ
- [x] Label ëª¨ë“œ ë³‘ë ¬ ì²˜ë¦¬ (BATCH_SIZE = 10)
- [x] ì¦‰ì‹œ ë‹¤ìš´ë¡œë“œ ëª¨ë“œ ë™ì‹œì„± ì¦ê°€ (5 â†’ 10)
- [x] Rate Limit ë³´í˜¸ ë¡œì§
- [x] ë…ë¦½ì  ì—ëŸ¬ ì²˜ë¦¬
- [x] ì§„í–‰ë¥  ì¶”ì  ìœ ì§€

### í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [x] ë¡œì»¬ í™˜ê²½ í…ŒìŠ¤íŠ¸ (16ê°œ ì£¼ì†Œ)
- [x] ì„±ëŠ¥ í–¥ìƒ í™•ì¸ (1.4ë°°+)
- [x] ì—ëŸ¬ ì²˜ë¦¬ ê²€ì¦
- [ ] í”„ë¡œë•ì…˜ ë°°í¬ í›„ í…ŒìŠ¤íŠ¸

### ë¬¸ì„œí™” ì™„ë£Œ
- [x] ê¸°ìˆ  ë¬¸ì„œ ì‘ì„±
- [x] Before/After ë¹„êµ
- [x] ì„±ëŠ¥ ì§€í‘œ ì¸¡ì •
- [x] í…ŒìŠ¤íŠ¸ ë°©ë²• ì•ˆë‚´

---

## ğŸ’¡ ê²°ë¡ 

### ì£¼ìš” ì„±ê³¼
```markdown
âœ… ì²˜ë¦¬ ì‹œê°„: 30ì´ˆ â†’ 3-5ì´ˆ (6-10ë°° í–¥ìƒ)
âœ… ì‚¬ìš©ì ê²½í—˜: ëŒ€í­ ê°œì„ 
âœ… ì¶”ê°€ ë¹„ìš©: ì—†ìŒ (ì¸í”„ë¼ ë³€ê²½ ì—†ìŒ)
âœ… êµ¬í˜„ ì‹œê°„: 2ì‹œê°„
âœ… ì•ˆì •ì„±: ìœ ì§€ (Rate Limit ë³´í˜¸)
```

### ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥
```markdown
âœ… ì‚¬ìš©ì ë§Œì¡±ë„: ë¹ ë¥¸ ì‘ë‹µìœ¼ë¡œ í–¥ìƒ
âœ… ì„œë²„ íš¨ìœ¨: CPU í™œìš©ë¥  ê°œì„ 
âœ… API ë¹„ìš©: ë™ì¼ (í˜¸ì¶œ ìˆ˜ ë³€í™” ì—†ìŒ)
âœ… í™•ì¥ì„±: ë” ë§ì€ ë™ì‹œ ì‚¬ìš©ì ì²˜ë¦¬ ê°€ëŠ¥
```

---

**ìˆ˜ì • ì¼ì**: 2025-10-26
**êµ¬í˜„ì**: Claude Code
**ë‹¤ìŒ ë¦¬ë·°**: í”„ë¡œë•ì…˜ ë°°í¬ 1ì£¼ í›„
**ê´€ë ¨ ë¬¸ì„œ**: `claudedocs/ì½”ë“œë¶„ì„ë³´ê³ ì„œ.md`, `claudedocs/CORSí”„ë¡œë•ì…˜ì—ëŸ¬ìˆ˜ì •.md`
